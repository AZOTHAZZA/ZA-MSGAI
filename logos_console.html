<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI-Z - ãƒ­ã‚´ã‚¹ç›£æŸ»ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn-nav {
            @apply p-3 text-sm font-semibold rounded-lg transition duration-200 hover:opacity-80;
        }
        .console-output {
            @apply h-[70vh] overflow-y-scroll bg-gray-800 p-4 text-sm rounded-lg border border-gray-700 font-mono;
        }
        /* ãƒ­ã‚°ã‚¿ã‚¤ãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .system-message { color: #a78bfa; } /* violet-400 */
        .audit-message { color: #60a5fa; } /* blue-400 */
        .error-message { color: #f87171; } /* red-400 */
        .warning-message { color: #facc15; } /* yellow-400 */
        .critical-warning { color: #fb923c; } /* orange-400 */
        .critical-error { color: #ef4444; } /* red-500 */
        .internal-message { color: #c4b5fd; } /* purple-300 */
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    
    <div class="flex justify-between items-center mb-8 border-b border-blue-500 pb-4">
        <h1 class="text-3xl font-extrabold text-blue-400">
            ğŸ’¬ ãƒ­ã‚´ã‚¹ç›£æŸ»ã‚³ãƒ³ã‚½ãƒ¼ãƒ« (æ¨è«–ã¨Z-Function)
        </h1>
        <div class="space-x-4">
             <a href="index.html" class="btn-nav bg-indigo-600">
                ğŸ  ãƒˆãƒƒãƒ—ãƒãƒ–ã¸
            </a>
            <a href="lil_editor.html" class="btn-nav bg-purple-700">
                ğŸ’» CalcLangã‚¨ãƒ‡ã‚£ã‚¿ã¸
            </a>
        </div>
    </div>
    
    <div class="w-full max-w-6xl mx-auto space-y-4">
        
        <div id="console_output" class="console-output">
            <div class="system-message">> [SYSTEM]: ãƒ­ã‚´ã‚¹ç›£æŸ»ãƒ—ãƒ­ãƒˆã‚³ãƒ« Î©Î± ã‚³ã‚¢èµ·å‹•ã€‚</div>
            <div class="system-message">> [SYSTEM]: ã‚³ãƒãƒ³ãƒ‰ä¾‹: /status, /rates, /balance USER_AUDIT_B</div>
        </div>

        <div class="flex space-x-4">
            <input type="text" id="console_input" placeholder="ãƒ­ã‚´ã‚¹æ¨è«–ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›..." 
                   class="flex-grow p-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-blue-500"
                   onkeydown="if(event.key === 'Enter') executeCommand()">
            <button onclick="executeCommand()" id="execute_button"
                    class="p-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition duration-150">
                å®Ÿè¡Œ (æ¨è«–ä½œç‚º)
            </button>
        </div>
    </div>
    
    <script type="module">
        import { initApp, UI_ELEMENTS, registerRenderCallback, logToConsole } from './core_logic.js'; 
        import { executeDialogueAct } from './dialogue_acts.js'; 

        const inputElement = document.getElementById('console_input');
        const outputElement = document.getElementById('console_output');
        
        // ãƒ­ã‚°å‡ºåŠ›ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã€UIã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚è¡¨ç¤º
        const originalLogToConsole = logToConsole;
        logToConsole = function(message, type = 'system-message') {
            originalLogToConsole(message, type);
            if (outputElement) {
                const logEntry = document.createElement('div');
                logEntry.className = type;
                
                // Markdownã®**ã‚’å¤ªå­—ã«å¤‰æ›ï¼ˆç°¡æ˜“å¯¾å¿œï¼‰
                const formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                logEntry.innerHTML = `> [${type.toUpperCase().replace('-', ' ')}]: ${formattedMessage}`;
                outputElement.appendChild(logEntry);
                outputElement.scrollTop = outputElement.scrollHeight; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
            }
        };
        
        window.executeCommand = async function() {
            const input = inputElement.value.trim();
            if (!input) return;

            // å…¥åŠ›ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
            logToConsole(`> ${input}`, 'internal-message');
            
            // å¯¾è©±ä½œç‚ºã®å®Ÿè¡Œ
            const { result, type } = await executeDialogueAct(input);
            
            // çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
            logToConsole(result, type);
            
            inputElement.value = '';
        }

        // ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã®UI_ELEMENTSã‚’å†åˆ©ç”¨
        UI_ELEMENTS.audit_log = outputElement; // ãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ã—ã¦ç™»éŒ²

        document.addEventListener('DOMContentLoaded', async () => {
            await initApp(); 
            // NOTE: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ç‰¹ã«å¿…è¦ã¨ã—ãªã„ãŸã‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ä¸è¦ã€‚
            logToConsole("[SYSTEM]: ãƒ­ã‚´ã‚¹æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³å¾…æ©Ÿä¸­ã€‚", 'system-message');
        });
    </script>
</body>
</html>
