<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµŒæ¸ˆãƒãƒ– - Î©Î± ãƒ­ã‚´ã‚¹ç›£æŸ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { @apply bg-gray-800/70 p-6 rounded-xl shadow-lg border border-gray-700; }
        .input-style { @apply w-full p-2 rounded bg-gray-600 text-white border border-gray-500 focus:ring-purple-500 focus:border-purple-500; }
        .btn-style { @apply w-full px-4 py-2 font-bold rounded transition; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    
    <div class="w-full max-w-4xl mx-auto space-y-8">
        
        <header class="border-b border-purple-500 pb-4">
            <h1 class="text-4xl font-extrabold text-purple-400">
                ğŸ’° çµŒæ¸ˆãƒãƒ– (ALPHAé€šè²¨ã‚·ã‚¹ãƒ†ãƒ )
            </h1>
            <p class="text-sm text-gray-400 mt-1">ç›£æŸ»å®˜: <span id="user_id">USER_AUDIT_A</span> | çŠ¶æ…‹: <span id="halt_status">æ­£å¸¸ç¨¼åƒ</span></p>
        </header>

        <div class="card bg-purple-800/50 border-purple-700">
            <h2 class="text-xl font-bold mb-3 text-purple-300">ğŸ“ˆ è«–ç†çš„å£åº§æ®‹é«˜</h2>
            <div id="account_balances" class="space-y-2 text-lg font-mono">
                <p>USER_AUDIT_A: <span class="text-yellow-400">...</span> ALPHA</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div class="card bg-blue-800/50 border-blue-700">
                <h2 class="text-2xl font-bold text-blue-300 mb-4">âœ¨ é€šè²¨ç”Ÿæˆ (MINT)</h2>
                <p class="text-sm text-gray-300 mb-3">æ–°è¦ALPHAé€šè²¨ã‚’ã‚·ã‚¹ãƒ†ãƒ ã«è«–ç†çš„ã«è¿½åŠ ã™ã‚‹ä½œç‚ºã§ã™ã€‚</p>
                <div class="space-y-3">
                    <input type="number" id="mint_amount" placeholder="ç”Ÿæˆã™ã‚‹é‡‘é¡ (ALPHA)" class="input-style">
                    <input type="text" id="mint_target" placeholder="ç”Ÿæˆå…ˆå£åº§ID (ä¾‹: USER_AUDIT_A)" class="input-style">
                    <button onclick="executeEconomicAct('MINT')" class="btn-style bg-blue-500 text-white hover:bg-blue-600">
                        ç”Ÿæˆä½œç‚ºã‚’å®Ÿè¡Œ
                    </button>
                </div>
            </div>

            <div class="card bg-yellow-800/50 border-yellow-700">
                <h2 class="text-2xl font-bold text-yellow-300 mb-4">ğŸ’¸ å£åº§é–“é€é‡‘ (TRANSFER)</h2>
                <p class="text-sm text-gray-300 mb-3">æ—¢å­˜ã®ALPHAé€šè²¨ã‚’åˆ¥ã®è«–ç†çš„å£åº§ã¸é€é‡‘ã™ã‚‹ä½œç‚ºã§ã™ã€‚</p>
                <div class="space-y-3">
                    <input type="number" id="transfer_amount" placeholder="é€é‡‘é‡‘é¡ (ALPHA)" class="input-style">
                    <input type="text" id="transfer_target" placeholder="é€é‡‘å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ID (ä¾‹: USER_AUDIT_B)" class="input-style">
                    <button onclick="executeEconomicAct('TRANSFER')" class="btn-style bg-yellow-500 text-gray-900 hover:bg-yellow-600">
                        é€é‡‘ä½œç‚ºã‚’å®Ÿè¡Œ
                    </button>
                </div>
            </div>
        </div>

        <div class="card bg-green-800/50 border-green-700">
            <h2 class="text-2xl font-bold text-green-300 mb-4">ğŸ§ è«–ç†çš„å‡ºé‡‘ (ATM / BRIDGE-OUT)</h2>
            <p class="text-sm text-gray-300 mb-3">
                è«–ç†çš„é€šè²¨ã‚’æ¶ˆè²»ã—ã€**ç”Ÿè¨ˆç¶­æŒ**ã®ãŸã‚ã®å¤–éƒ¨ã®æœ‰é™ãªä¾¡å€¤ã«å¤‰æ›ã™ã‚‹ä½œç‚ºã§ã™ã€‚Vibrationã‚¹ã‚³ã‚¢ãŒå¢—åŠ ã—ã¾ã™ã€‚
            </p>
            <div class="space-y-3">
                <input type="number" id="withdraw_amount" placeholder="å‡ºé‡‘é‡‘é¡ (ALPHAé€šè²¨)" class="input-style">
                <button onclick="executeEconomicAct('WITHDRAW')" class="btn-style bg-green-500 text-white hover:bg-green-600">
                    å‡ºé‡‘ä½œç‚ºã‚’å®Ÿè¡Œ (ATM)
                </button>
            </div>
        </div>
        
        <hr class="border-gray-700">

        <h3 class="text-xl font-bold text-gray-300 mb-2">ç›£æŸ»ãƒ­ã‚° (ä½œç‚ºã®å±¥æ­´)</h3>
        <div id="console" class="bg-gray-800 p-4 rounded-lg h-40 overflow-y-auto text-sm font-mono text-gray-200">
            <div>[INIT] çµŒæ¸ˆãƒãƒ–èµ·å‹•ã€‚ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã®æ¥ç¶šã‚’å¾…æ©Ÿä¸­...</div>
        </div>

    </div>
    
    <script src="js/core_logic.js"></script>
    <script src="js/audit_acts.js"></script>
    <script src="js/logos_lil.js"></script>
    <script src="js/firebase_config.js"></script>
    <script src="js/dialogue_acts.js"></script>

    <script>
        // çŠ¶æ…‹è¡¨ç¤ºç”¨ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©ï¼ˆindex.htmlã¨åŒæ§˜ã®ç°¡ç•¥åŒ–ï¼‰
        const UI_ELEMENTS = {
            account_balances: document.getElementById('account_balances'),
            consoleDiv: document.getElementById('console'),
            halt_status: document.getElementById('halt_status')
        };

        /**
         * ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°ã€‚
         */
        function logToConsole(message, className = 'text-gray-200') {
            const now = new Date().toLocaleTimeString();
            UI_ELEMENTS.consoleDiv.innerHTML += `<div class="mt-1 ${className}">[${now}] ${message}</div>`;
            UI_ELEMENTS.consoleDiv.scrollTop = UI_ELEMENTS.consoleDiv.scrollHeight;
        }
        
        /**
         * ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦UIã‚’æ›´æ–°ã—ã€æ®‹é«˜ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
         * @param {object} state - ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã€‚
         */
        window.renderMainUI = function(state) {
            // 1. æ®‹é«˜è¡¨ç¤ºã®æ›´æ–° (å£åº§ä¿å­˜æ©Ÿèƒ½)
            let balanceHtml = '';
            for (const id in state.accounts) {
                const alpha = state.accounts[id].ALPHA.toFixed(2);
                balanceHtml += `<p>${id}: <span class="text-yellow-400">${alpha}</span> ALPHA`;
                if (state.accounts[id].fiat_balance !== undefined) {
                    balanceHtml += ` / ç¾å®Ÿä¾¡å€¤: <span class="text-green-400">${state.accounts[id].fiat_balance.toFixed(2)}</span> JPY`
                }
                balanceHtml += '</p>';
            }
            UI_ELEMENTS.account_balances.innerHTML = balanceHtml;

            // 2. HALTã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°
            if (UI_ELEMENTS.halt_status) {
                 UI_ELEMENTS.halt_status.textContent = state.systemState.isHalted ? 'âŒ HALT (è«–ç†åœæ­¢)' : 'âœ… æ­£å¸¸ç¨¼åƒ';
            }
        };

        /**
         * çµŒæ¸ˆãƒãƒ–ã‹ã‚‰ã®ä½œç‚ºã‚’å‡¦ç†ã—ã€dialogue_acts.jsã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹é–¢æ•°ã€‚
         */
        function executeEconomicAct(type) {
            let command;
            const sourceId = document.getElementById('user_id')?.textContent || 'USER_AUDIT_A';

            if (type === 'MINT') {
                const amount = document.getElementById('mint_amount').value;
                const targetId = document.getElementById('mint_target').value;
                if (!amount || !targetId) return logToConsole('[FAIL] é‡‘é¡ã¨ç”Ÿæˆå…ˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'text-red-400');
                command = `MINT ${targetId} ${amount}`;

            } else if (type === 'TRANSFER') {
                const amount = document.getElementById('transfer_amount').value;
                const targetId = document.getElementById('transfer_target').value;
                if (!amount || !targetId) return logToConsole('[FAIL] é‡‘é¡ã¨é€é‡‘å…ˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'text-red-400');
                // TRANSFER {source} {amount} {target} 
                command = `TRANSFER ${sourceId} ${amount} ${targetId}`; 

            } else if (type === 'WITHDRAW') {
                const amount = document.getElementById('withdraw_amount').value;
                if (!amount) return logToConsole('[FAIL] å‡ºé‡‘é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'text-red-400');
                // WITHDRAW {source} {amount} (ACT_BRIDGE_OUTã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹)
                command = `WITHDRAW ${sourceId} ${amount}`; 
            }

            if (command && window.processDialogueAsAct) {
                logToConsole(`[LOGIC ACT] ${type} ä½œä¸ºã‚’å®Ÿè¡Œ: ${command}`);
                const result = window.processDialogueAsAct(command);

                const status = result.log[0].status;
                logToConsole(`-> [ç›£æŸ»çµæœ] ${status}: ${result.log[0].action || result.log[0].reason}`, status === 'SUCCESS' || status === 'CRITICAL_SUCCESS' ? 'text-green-400' : 'text-red-400');
                
                // UIã®çŠ¶æ…‹ã‚’æ›´æ–°
                window.renderMainUI(result.newState); 

            } else {
                 logToConsole('[CRITICAL FAIL] ã‚³ãƒãƒ³ãƒ‰ã¾ãŸã¯ãƒ—ãƒ­ã‚»ã‚¹é–¢æ•°ãŒæœªå®šç¾©ã§ã™ã€‚', 'text-red-500');
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // initApp (firebase_config.jsã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©) ã‚’å‘¼ã³å‡ºã—ã€çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ãƒ‰
            if (window.initApp) {
                const initialState = await window.initApp(); 
                window.renderMainUI(initialState);
            } else {
                logToConsole('[CRITICAL FAIL] ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (initApp) ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'text-red-500');
            }
        });
    </script>
</body>
</html>
