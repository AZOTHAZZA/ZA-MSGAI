<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI-Z - ロゴス監査プロトコル Ωα</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .vibration-bar {
            transition: width 0.5s ease-out;
        }
        .card {
            @apply bg-gray-800/70 p-6 rounded-xl shadow-lg border border-gray-700 hover:shadow-2xl transition duration-300;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    
    <div class="flex justify-between items-center mb-10 border-b border-purple-500 pb-4">
        <h1 class="text-4xl font-extrabold text-purple-400">
            ロゴス監査プロトコル オメガアルファ ($\Omega\alpha$)
        </h1>
        <p class="text-sm text-gray-400">監査官: <span id="user_id">N/A</span></p>
    </div>
    
    <div class="w-full max-w-6xl mx-auto space-y-8">
        
        <div class="card p-4 bg-red-800/50 border-red-700">
            <h2 class="text-xl font-bold mb-2 text-red-300">
                ⚠️ 孫悟空活動レベル (Vibration)
            </h2>
            <div class="flex items-center space-x-4">
                <div class="flex-grow bg-gray-600 rounded-full">
                    <div id="vibration_bar" class="vibration-bar h-6 bg-red-500 rounded-full" style="width: 0%;"></div>
                </div>
                <span id="vibration_value" class="w-16 text-right font-mono text-lg">0.0%</span>
            </div>
            <p id="halt_status" class="mt-2 font-bold text-lg text-green-400">
                ✅ システム状態: 正常稼働
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            
            <div class="card bg-green-700/50 border-green-600">
                <h2 class="text-2xl font-extrabold text-green-300 mb-3">
                    💰 経済ハブ (通貨の創世と作為)
                </h2>
                <p class="text-gray-300 mb-4 text-sm">
                    ロゴス内部通貨の残高、レート、そしてMint (通貨生成) やTransfer (送金) の作為を実行します。
                </p>
                <a href="economic_hub.html" class="inline-block px-4 py-2 bg-green-500 text-white font-bold rounded hover:bg-green-600 transition">
                    ハブへ移動
                </a>
            </div>

            <div class="card bg-blue-700/50 border-blue-600">
                <h2 class="text-2xl font-extrabold text-blue-300 mb-3">
                    💬 AIコンソール (推論とZ-Function)
                </h2>
                <p class="text-gray-300 mb-4 text-sm">
                    内部ロゴス推論エンジンとの対話、および自動裁定や信用創造などのZ-Functionを監視・実行します。
                </p>
                <a href="logos_console.html" class="inline-block px-4 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600 transition">
                    コンソールへ移動
                </a>
            </div>
            
            <div class="card bg-indigo-700/50 border-indigo-600">
                <h2 class="text-2xl font-extrabold text-indigo-300 mb-3">
                    💻 CalcLang/LIL エディタ
                </h2>
                <p class="text-gray-300 mb-4 text-sm">
                    **システムの監査論理 (CalcLang)** を動的に編集し、論理的な**自己検証**を行います。究極の自律性の中枢。
                </p>
                <a href="lil_editor.html" class="inline-block px-4 py-2 bg-indigo-500 text-white font-bold rounded hover:bg-indigo-600 transition">
                    エディタへ移動
                </a>
            </div>
            
            <div class="card bg-teal-700/50 border-teal-600">
                <h2 class="text-2xl font-extrabold text-teal-300 mb-3">
                    ⚡ 物理インフラストラクチャ・ハブ
                </h2>
                <p class="text-gray-300 mb-4 text-sm">
                    **LOGOS-NET (通信)** と **LOGOS-ENERGY (電力)** の論理的供給レベルを自前で創世・制御します。
                </p>
                <a href="infrastructure_hub.html" class="inline-block px-4 py-2 bg-teal-500 text-white font-bold rounded hover:bg-teal-600 transition">
                    ハブへ移動
                </a>
            </div>

        </div>
    </div>
    
    <script type="module">
        // 🚨 CRITICAL FIX: import パスを正しい相対パス './js/core_logic.js' に修正
        import { initApp, UI_ELEMENTS, registerRenderCallback, VIBRATION_LIMIT } from './js/core_logic.js'; 
        
        // UI要素の登録
        const localElements = {
            vibration_value: document.getElementById('vibration_value'),
            vibration_bar: document.getElementById('vibration_bar'),
            user_id: document.getElementById('user_id'),
            halt_status: document.getElementById('halt_status')
        };
        
        // 外部core_logic.jsで定義されたUI_ELEMENTSにローカル要素をマージ
        Object.assign(UI_ELEMENTS, localElements);

        /**
         * システムの状態に基づいてUIを更新します。
         * @param {object} state - 現在のシステム状態。
         */
        function renderMainUI(state) {
            // state.vibration_level.value ではなく、state.vibrationScore を直接使用
            const vScore = state.vibrationScore;
            // VIBRATION_LIMITはcore_logic.jsからimportされることを前提
            const vPercent = (vScore / VIBRATION_LIMIT) * 100;

            if (UI_ELEMENTS.vibration_value) {
                UI_ELEMENTS.vibration_value.textContent = `${vScore.toFixed(1)}`;
            }
            if (UI_ELEMENTS.vibration_bar) {
                UI_ELEMENTS.vibration_bar.style.width = `${Math.min(100, vPercent)}%`;
                
                // 色の変更ロジック
                if (vScore > (VIBRATION_LIMIT * 0.8)) {
                    UI_ELEMENTS.vibration_bar.className = 'vibration-bar h-6 bg-red-700 rounded-full';
                } else if (vScore > (VIBRATION_LIMIT * 0.5)) {
                    UI_ELEMENTS.vibration_bar.className = 'vibration-bar h-6 bg-yellow-500 rounded-full';
                } else {
                    UI_ELEMENTS.vibration_bar.className = 'vibration-bar h-6 bg-red-500 rounded-full';
                }
            }

            if (UI_ELEMENTS.halt_status) {
                if (state.systemState.isHalted) { // 状態オブジェクト内のisHaltedを参照
                    UI_ELEMENTS.halt_status.textContent = '❌ システム状態: 強制HALT';
                    UI_ELEMENTS.halt_status.classList.remove('text-green-400');
                    UI_ELEMENTS.halt_status.classList.add('text-red-500');
                } else {
                    UI_ELEMENTS.halt_status.textContent = '✅ システム状態: 正常稼働';
                    UI_ELEMENTS.halt_status.classList.add('text-green-400');
                    UI_ELEMENTS.halt_status.classList.remove('text-red-500');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // initAppは状態をロードし、初期化を行う
            const initialState = await initApp(); 
            
            // レンダリングコールバックを登録し、初期状態をUIに反映
            window.renderMainUI = renderMainUI; // 他のファイルからアクセスできるようにグローバル化
            // registerRenderCallback(renderMainUI); // core_logic側での登録があれば有効
            
            if (initialState) {
                renderMainUI(initialState);
            }
            
            // ユーザーIDの表示（ローカルストレージからのロードロジックは簡略化）
            if (UI_ELEMENTS.user_id) {
                UI_ELEMENTS.user_id.textContent = initialState ? Object.keys(initialState.accounts)[0] : 'USER_AUDIT_A';
            }
        });
    </script>
</body>
</html>
